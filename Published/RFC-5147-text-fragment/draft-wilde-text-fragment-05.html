
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>URI Fragment Identifiers for the text/plain Media Type</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="URI Fragment Identifiers for the text/plain Media Type">
<meta name="generator" content="xml2rfc v1.30 (http://xml.resource.org/)">
<style type='text/css'>
<!--
    body {
        font-family: verdana, charcoal, helvetica, arial, sans-serif;
        margin: 2em;
        font-size: small ; color: #000000 ; background-color: #ffffff ; }
    .title { color: #990000; font-size: x-large ;
        font-weight: bold; text-align: right;
        font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
        background-color: transparent; }
    .filename { color: #666666; font-size: 18px; line-height: 28px;
        font-weight: bold; text-align: right;
        font-family: helvetica, arial, sans-serif;
        background-color: transparent; }
    td.rfcbug { background-color: #000000 ; width: 30px ; height: 30px ;
        text-align: justify; vertical-align: middle ; padding-top: 2px ; }
    td.rfcbug span.RFC { color: #666666; font-weight: bold; text-decoration: none;
        background-color: #000000 ;
        font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
        font-size: x-small ; }
    td.rfcbug span.hotText { color: #ffffff; font-weight: normal; text-decoration: none;
        text-align: center ;
        font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
        font-size: x-small ; background-color: #000000; }
    /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
    div#counter{margin-top: 100px}

    a.info{
        position:relative; /*this is the key*/
        z-index:24;
        text-decoration:none}

    a.info:hover{z-index:25; background-color:#990000 ; color: #ffffff ;}

    a.info span{display: none}

    a.info:hover span.info{ /*the span will display just on :hover state*/
        display:block;
        position:absolute;
        font-size: smaller ;
        top:2em; left:2em; width:15em;
        padding: 2px ;
        border:1px solid #333333;
        background-color:#eeeeee; color:#990000;
        text-align: left ;}

     A { font-weight: bold; }
     A:link { color: #990000; background-color: transparent ; }
     A:visited { color: #333333; background-color: transparent ; }
     A:active { color: #333333; background-color: transparent ; }

    p { margin-left: 2em; margin-right: 2em; }
    p.copyright { font-size: x-small ; }
    p.toc { font-size: small ; font-weight: bold ; margin-left: 3em ;}
    table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
    td.toc { font-size: small; font-weight: bold; vertical-align: text-top; }

    span.emph { font-style: italic; }
    span.strong { font-weight: bold; }
    span.verb, span.vbare { font-family: "Courier New", Courier, monospace ; }

    span.vemph { font-style: italic; font-family: "Courier New", Courier, monospace ; }
    span.vstrong { font-weight: bold; font-family: "Courier New", Courier, monospace ; }
    span.vdeluxe { font-weight: bold; font-style: italic; font-family: "Courier New", Courier, monospace ; }

    ol.text { margin-left: 2em; margin-right: 2em; }
    ul.text { margin-left: 2em; margin-right: 2em; }
    li { margin-left: 3em;  }

    pre { margin-left: 3em; color: #333333;  background-color: transparent;
        font-family: "Courier New", Courier, monospace ; font-size: small ;
        text-align: left;
        }

    h3 { color: #333333; font-size: medium ;
        font-family: helvetica, arial, sans-serif ;
        background-color: transparent; }
    h4 { font-size: small; font-family: helvetica, arial, sans-serif ; }

    table.bug { width: 30px ; height: 15px ; }
    td.bug { color: #ffffff ; background-color: #990000 ;
        text-align: center ; width: 30px ; height: 15px ;
         }
    td.bug A.link2 { color: #ffffff ; font-weight: bold;
        text-decoration: none;
        font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
        font-size: x-small ; background-color: transparent }

    td.header { color: #ffffff; font-size: x-small ;
        font-family: arial, helvetica, sans-serif; vertical-align: top;
        background-color: #666666 ; width: 33% ; }
    td.author { font-weight: bold; margin-left: 4em; font-size: x-small ; }
    td.author-text { font-size: x-small; }
    table.full { vertical-align: top ; border-collapse: collapse ;
        border-style: solid solid solid solid ;
        border-color: black black black black ;
        font-size: small ; text-align: center ; }
    table.headers, table.none { vertical-align: top ; border-collapse: collapse ;
        border-style: none;
        font-size: small ; text-align: center ; }
    table.full th { font-weight: bold ;
        border-style: solid ;
        border-color: black black black black ; }
    table.headers th { font-weight: bold ;
        border-style: none none solid none;
        border-color: black black black black ; }
    table.none th { font-weight: bold ;
        border-style: none; }
    table.full td {
        border-style: solid solid solid solid ;
        border-color: #333333 #333333 #333333 #333333 ; }
    table.headers td, table.none td { border-style: none; }

    hr { height: 1px }
-->
</style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">E. Wilde</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">ETH Zurich</td></tr>
<tr><td class="header">Expires: July 10, 2006</td><td class="header">Jan 6, 2006</td></tr>
</table></td></tr></table>
<div align="right"><span class="title"><br />URI Fragment Identifiers for the text/plain Media Type</span></div>
<div align="right"><span class="title"><br />draft-wilde-text-fragment-05</span></div>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on July 10, 2006.</p>

<h3>Copyright Notice</h3>
<p>
Copyright &copy; The Internet Society (2006).</p>

<h3>Abstract</h3>

<p>This memo defines URI fragment identifiers for text/plain MIME entities. These fragment identifiers make it possible to refer to parts of a text MIME entity, identified by character count or range, line count or range, or a regular expression. These identification methods can be combined to identify more than one sub-resource of a text/plain MIME entity. Fragment identifiers may also contain hash information to make them more robust.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
What is text/plain?<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#lineending">1.1.1.</a>&nbsp;
Line Endings in text/plain MIME Entities<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
What is a URI Fragment Identifier?<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#why">1.3.</a>&nbsp;
Why text/plain Fragment Identifiers?<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#incremental">1.4.</a>&nbsp;
Incremental Deployment<br />
<a href="#anchor4">2.</a>&nbsp;
Fragment Identification Methods<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.1.</a>&nbsp;
Fragment Identification Schemes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#princ">2.1.1.</a>&nbsp;
Principles<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#comb-principle">2.1.2.</a>&nbsp;
Combining the Principles<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#regex">2.1.3.</a>&nbsp;
Regular Expressions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#combining">2.1.4.</a>&nbsp;
Combining Fragment Identification Scheme Parts<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#robustness">2.2.</a>&nbsp;
Fragment Identifier Robustness<br />
<a href="#syntax">3.</a>&nbsp;
Fragment Identification Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.1.</a>&nbsp;
Non-ASCII Characters in Regular Expressions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#hashsums">3.2.</a>&nbsp;
Hash Sums<br />
<a href="#processing">4.</a>&nbsp;
Fragment Identifier Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#position-handling">4.1.</a>&nbsp;
Handling of position Values<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#hash-handling">4.2.</a>&nbsp;
Handling of Hash Sums<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#error-handling">4.3.</a>&nbsp;
Syntax Errors in Fragment Identifiers<br />
<a href="#examples">5.</a>&nbsp;
Examples<br />
<a href="#security">6.</a>&nbsp;
Security Considerations<br />
<a href="#anchor7">7.</a>&nbsp;
Change Log<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">7.1.</a>&nbsp;
From -04 to -05<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">7.2.</a>&nbsp;
From -03 to -04<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">7.3.</a>&nbsp;
From -02 to -03<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">7.4.</a>&nbsp;
From -01 to -02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">7.5.</a>&nbsp;
From -00 to -01<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Non-Normative References<br />
<a href="#anchor15">Appendix&nbsp;A.</a>&nbsp;
Where to send Comments<br />
<a href="#anchor16">Appendix&nbsp;B.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;Introduction</h3>

<p>Compliant software MUST follow this specification. The capitalized key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 <a class="info" href="#RFC2119">[1]<span> (</span><span class="info">Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;What is text/plain?</h3>

<p>Internet Media Types as defined in RFC 2045 <a class="info" href="#RFC2045">[2]<span> (</span><span class="info">Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a> and RFC 2046 <a class="info" href="#RFC2046">[3]<span> (</span><span class="info">Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types,&rdquo; November&nbsp;1996.</span><span>)</span></a> are used to identify different types and sub-types of media. RFC 2046 <a class="info" href="#RFC2046">[3]<span> (</span><span class="info">Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types,&rdquo; November&nbsp;1996.</span><span>)</span></a> and RFC 3676 <a class="info" href="#RFC3676">[4]<span> (</span><span class="info">Gellens, R., &ldquo;The Text/Plain Format and DelSp Parameters,&rdquo; February&nbsp;2004.</span><span>)</span></a> specify the text/plain media type, which is used for simple, unformatted text. Quoting from RFC 2046 <a class="info" href="#RFC2046">[3]<span> (</span><span class="info">Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types,&rdquo; November&nbsp;1996.</span><span>)</span></a>: "Plain text does not provide for or allow  formatting commands, font attribute specifications, processing instructions, interpretation directives, or content markup. Plain text is seen simply as a linear sequence of characters, possibly interrupted by line breaks or page breaks."
</p>
<p>The text/plain media type does not restrict the character encoding, any character encoding may be used. In the absence of an explicit character encoding declaration, US-ASCII is assumed as the default character encoding. This variability of the character encoding makes it impossible to count characters in a text/plain MIME entity without taking the character encoding into account, because there are many character encodings using more than one octet per character.
</p>
<p>The biggest advantage of text/plain MIME entities is their ease of use and their portability among different platforms. As long as they use popular character encodings (such as US-ASCII), they can be displayed and processed on virtually every computer system.
</p>
<a name="lineending"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1.1"></a><h3>1.1.1.&nbsp;Line Endings in text/plain MIME Entities</h3>

<p>RFC 2046 <a class="info" href="#RFC2046">[3]<span> (</span><span class="info">Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types,&rdquo; November&nbsp;1996.</span><span>)</span></a> and RFC 3676 <a class="info" href="#RFC3676">[4]<span> (</span><span class="info">Gellens, R., &ldquo;The Text/Plain Format and DelSp Parameters,&rdquo; February&nbsp;2004.</span><span>)</span></a> specify that line endings in text/plain MIME entities are represented by CR+LF character sequences. In implementation practice, however, text/plain MIME entities use different conventions, for example depending on the operating system they have been created with (in most cases, Unix uses LF, MacOS uses CR, and Windows uses CR+LF). Because of this diversity of conventions, implementations interpreting text/plain fragment identifiers MUST take different line ending conventions into account.
</p>
<p>Line endings in text/plain MIME entities MAY be represented by other character (sequences) than CR+LF, specifically CR, LF, NEL, and CR+NEL. All these character (sequences) MUST be interpreted as line endings. This interpretation MUST affect the evaluation of text/plain fragment identifiers. All representations of line endings (CR+LF, CR, LF, NEL, and CR+NEL) MUST be treated as a single character in character counts. For the purpose of regular expression matching, all representations of line endings MUST be treated as single LF characters. The reason for this is that fragment identifiers should not be broken by converting a file from one line ending convention to another.
</p>
<p>In general, the line ending conventions used in text/plain MIME entities depends on the character encoding of the MIME entity. Implementations SHOULD attempt to be as accurate as possible in recognizing line ending specific to particular character encodings, and MUST treat all these line endings as one character in character counts, and single LF characters for regular expression matching.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;What is a URI Fragment Identifier?</h3>

<p>URIs are the identification mechanism for resources on the Web. The URI syntax specified in RFC 3986 <a class="info" href="#RFC3986">[5]<span> (</span><span class="info">Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> includes as part of a URI a fragment identifier, which (quoting from RFC 3986 <a class="info" href="#RFC3986">[5]<span> (</span><span class="info">Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>) "consists of additional reference information to be interpreted by the user agent after the retrieval action has been successfully completed.  As such, it is not part of a URI, but is often used in conjunction with a URI. The semantics of a fragment identifier is a property of the data resulting from a retrieval action, regardless of the type of URI used in the reference.  Therefore, the format and interpretation of fragment identifiers is dependent on the media type of the retrieval result."
</p>
<p>The most popular fragment identifier is defined for text/html (defined in RFC 2854 <a class="info" href="#RFC2854">[10]<span> (</span><span class="info">Connolly, D. and L. Masinter, &ldquo;The 'text/html' Media Type,&rdquo; June&nbsp;2000.</span><span>)</span></a>), and makes it possible to refer to a specific element (identified by a 'name' or 'id' attribute) of an HTML document.
</p>
<a name="why"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;Why text/plain Fragment Identifiers?</h3>

<p>Referring to specific parts of a resource can be very useful, because it enables users and applications to create more specific references. Rather than pointing to a whole resource, users can create references to the part they really are interested in or want to talk about. Even though it is suggested that fragment identification methods are specified in a media type's MIME registration, many media types do not have fragment identification methods associated with them.
</p>
<p>Fragment identifiers are only useful if supported by the client, because they are only interpreted by the client. Therefore, a new fragment identification method will require some time to be adopted by clients, and older clients will not support it. However, because the URI still works even if the fragment identifier is not supported (the resource is retrieved, but the fragment identifier is not interpreted), rapid adoption is not highly critical to ensure the success of a new fragment identification method.
</p>
<p>Fragment identifiers for text/plain make it possible to refer to specific parts of a text MIME entity, using concepts of positions and ranges, which may be applied to characters and lines. The also support locating a fragment by using a regular expression for searching for a specific character sequence. Thus, text/plain fragment identifiers enable users to exchange information more specifically, thereby reducing time and effort that is necessary to manually search for the relevant part of a text/plain MIME entity.
</p>
<p>The text/plain format does not support the embedding of links, so in normal environments, text/plain resources can only serve as targets for links, and not as sources. However, when combining the text/plain fragment identifiers specified in this memo with out-of-line linking mechanisms such as XLink <a class="info" href="#XLink">[11]<span> (</span><span class="info">DeRose, S., Maler, E., and D. Orchard, &ldquo;XML Linking Language (XLink) Version 1.0,&rdquo; June&nbsp;2001.</span><span>)</span></a>, it is possible to "embed" link sources into plain/text resources. Thus, the text/plain fragment identifiers specified in this memo open a path for plain/text files to become fully integrated resources in hypermedia systems such as the Web.
</p>
<a name="incremental"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;Incremental Deployment</h3>

<p>As long as support for text/plain fragment identifiers is not implemented by all programs, it is important to consider the implications of incremental deployment. Clients (for example, Web browsers) not supporting the text/plain fragment identifier described in this memo will work with URI references to text/plain MIME entities, but they will fail to locate the sub-resource identified by the fragment identifier. This is a reasonable fallback behavior, and in general users should take into account the possibility that a program interpreting a given URI will fail to interpret the fragment identifier part. Since fragment identifier evaluation is local to the client (and happens after retrieving the MIME entity), there is no way for a server to determine whether a requesting client is using a URI containing a fragment identifier.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;Fragment Identification Methods</h3>

<p>The identification of fragments of text/plain MIME entities can be based on different foundations. Since it is not possible to insert explicit, invisible identifiers into a text/plain MIME entity (as for example used in HTML documents, implemented through special attributes), fragment identification has to rely on certain inherent criteria of the MIME entity. This memo specifies fragment identification using six different methods, which are character positions and ranges, line positions and ranges, regular expression matching, and a mechanism for improving the robustness of fragment identifiers (entity hashes).
</p>
<p> When interpreting character or line numbers, implementations MUST take the character encoding of the MIME entity into account, because character count and octet count may differ for the character encoding being used. For example, a MIME entity using UTF-16 encoding (as specified in RFC 2718 <a class="info" href="#RFC2781">[12]<span> (</span><span class="info">Hoffman, P. and F. Yergeau, &ldquo;UTF-16, an encoding of ISO 10646,&rdquo; February&nbsp;2000.</span><span>)</span></a>) uses two octets per character, and it may have a leading BOM (Byte-Order Mark), which does not count as a character and thus also affects the mapping from a simple octet count to a character count.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;Fragment Identification Schemes</h3>

<p>Fragment identification can be done using regular expressions or combining two orthogonal principles, which are positions and ranges, and characters and lines. The following section describe the principles themselves, while <a class="info" href="#comb-principle">Section&nbsp;2.1.2<span> (</span><span class="info">Combining the Principles</span><span>)</span></a> describes the combination of the principles.
</p>
<a name="princ"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1"></a><h3>2.1.1.&nbsp;Principles</h3>

<a name="princ-posrang"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1.1"></a><h3>2.1.1.1.&nbsp;Positions and Ranges</h3>

<p>A position does not identify an actual fragment of the MIME entity, but a position inside the MIME entity, which could be regarded as a fragment of zero length. The use case for positions is to provide pointers for applications which may use them to implement functionalities such as "insert some text here", which needs a position rather than a fragment. Positions are counted from zero (position zero being before the first character or line of a text/plain MIME entity), so that a text/plain MIME entity having one character has two positions, one before the first character (position 0), and one after the first character (position 1).
</p>
<p>Since positions are fragments of length zero, applications SHOULD use other methods than highlighting to indicate positions, the most obvious way being the positioning of a cursor (if the application supports the concept of a cursor).
</p>
<p>Ranges, on the other hand, identify fragments of a MIME entity that have a length that may be greater than zero. As a general principle for ranges, they specify both a lower and a upper bound. The start or the end of a range specification may be omitted, defaulting to the first repectively last position of the MIME entity. The ending position of a range must have a value greater than or equal to the lower position (consequently, a range with identical lower and upper positions is legal, and identifies a range of length 0, which is equivalent to a position). Counting for ranges uses positions, so that a fragment containing one entity is specified by using a range with two adjacent positions.
</p>
<p>Since ranges are fragments with a length greater than zero, applications SHOULD use methods like highlighting to indicate ranges (if the application supports the concept of highlighting).
</p>
<p>For positions and ranges it is implicitly assumed that if a number is greater than the actual number of elements in the MIME entity, then it is referring to the last element of the MIME entity (see <a class="info" href="#processing">Section&nbsp;4<span> (</span><span class="info">Fragment Identifier Processing</span><span>)</span></a> for the processing model).
</p>
<a name="char-and-line"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1.2"></a><h3>2.1.1.2.&nbsp;Characters and Lines</h3>

<p>The concept of positions and ranges may be applied to characters and lines. In both cases, positions indicate points between entities, while ranges identify zero or more entities by indicating positions.
</p>
<p>Character positions are numbered starting with zero (ignoring initial BOM marks or similar concepts that are not part of the actual textual content of a text/plain MIME entity), and counting each character separately, with the exception of line endings, which are always counted as one character (<a class="info" href="#lineending">Section&nbsp;1.1.1<span> (</span><span class="info">Line Endings in text/plain MIME Entities</span><span>)</span></a> describes how line endings MUST be identified).
</p>
<p>Line positions are numbered starting with zero (with line position zero always being identical with character position zero), with <a class="info" href="#lineending">Section&nbsp;1.1.1<span> (</span><span class="info">Line Endings in text/plain MIME Entities</span><span>)</span></a> describing how line endings MUST be identified. Fragments identified by lines include the line endings, so applications identifying line-based fragments MUST include the line endings in the fragment identification they are using (eg, the highlighted selection). If a MIME entity does not contain any line endings, then it consists of a single (the first) line.
</p>
<a name="comb-principle"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.2"></a><h3>2.1.2.&nbsp;Combining the Principles</h3>

<p>In the following sections, the principles described in the preceding section (positions/ranges and characters/lines) are combined, resulting in four use cases.
</p>
<a name="charposi"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.2.1"></a><h3>2.1.2.1.&nbsp;Character Position</h3>

<p>Using the char scheme followed by a single number, it is possible to point to a character position (ie, a fragment of length zero between two characters). Rather than identifying a fragment consisting of a number of characters, this method identifies a position between two characters (or before the first or after the last character). Character position counting starts with 0, so the character position before the first character of a text/plain MIME entity has the character position 0, and a MIME entity containing n distinct characters has n+1 distinct character positions, the last one having the character position n.
</p>
<a name="charrange"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.2.2"></a><h3>2.1.2.2.&nbsp;Character Range</h3>

<p>If it is necessary to identify a fragment of one or more characters using character counting, this can be done by using a character range, using the char scheme followed by a range specification. A character range is a consecutive region of the MIME entity that extends from the starting character position of the range to the ending character position of the range.
</p>
<a name="lineposi"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.2.3"></a><h3>2.1.2.3.&nbsp;Line Position</h3>

<p>Using the line scheme followed by a single number, it is possible to point to a line position (ie, a fragment of length zero between two lines). Rather than identifying a fragment consisting of a number of lines, this method identifies a position between two lines (or before the first or after the last line). Line position counting starts with 0, so the line position before the first line of a text/plain MIME entity has the line position 0, and a MIME entity containing n distinct lines has n+1 distinct line positions, the last one having the line position n.
</p>
<a name="linerange"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.2.4"></a><h3>2.1.2.4.&nbsp;Line Range</h3>

<p>If it is necessary to identify a fragment of one or more lines using line counting, this can be done by using a line range, using the line scheme followed by a range specification. A line range is a consecutive region of the MIME entity that extends from the starting line position of the range to the ending line position of the range.
</p>
<a name="regex"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.3"></a><h3>2.1.3.&nbsp;Regular Expressions</h3>

<p>A common problem with fragment identifiers is their robustness (to changes in the MIME entity), and character and line counts can break very easily. A more robust way of identifying a fragment is by searching for a specific pattern (another way of making fragment identifiers more robust is described in <a class="info" href="#robustness">Section&nbsp;2.2<span> (</span><span class="info">Fragment Identifier Robustness</span><span>)</span></a> about including entity hash sums in the fragment identifier). Thus, it is possible to use a Basic Regular Expression (BRE) as defined by ISO 9945-2 <a class="info" href="#ISO9945-2">[6]<span> (</span><span class="info">International Organization for Standardization, &ldquo;Information technology - Portable Operating System Interface (POSIX) - Part 2: Shell and Utilities,&rdquo; 1993.</span><span>)</span></a> (the POSIX standard) as a fragment identifier.
</p>
<a name="combining"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.4"></a><h3>2.1.4.&nbsp;Combining Fragment Identification Scheme Parts</h3>

<p>While in most cases only one fragment identification scheme part will be used, it is possible to combine them. By simply concatenating different fragment identification scheme parts, separated by a semicolon, the whole fragment identifier refers to the union of all fragments of the text/plain MIME entity identified by the individual fragment identification scheme parts. This way, it is possible to identify disjoint ranges, such as multiple line ranges.
</p>
<p>It should be noticed that regular expressions by themselves may identify disjoint fragments, which is true in any case where the regular expression matches more than one occurrence in the MIME entity.
</p>
<p>Since disjoint fragments can be identified, implementations SHOULD make sure that these fragments are appropriately marked, for example by highlighting the fragment (rather than only scrolling to some line, which only identifies a single position in the MIME entity). If an implementation can not mark disjoint fragments, it MAY resort to marking only the first of the disjoint fragments. However, the exact method of how implementations deal with disjoint fragments depends on the application and interface, and is beyond the scope of this memo.
</p>
<a name="robustness"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;Fragment Identifier Robustness</h3>

<p>While regular expressions (as described in <a class="info" href="#regex">Section&nbsp;2.1.3<span> (</span><span class="info">Regular Expressions</span><span>)</span></a>) may make fragment identifiers more robust than character or line counts, it is still possible that modifications of the resource will break the fragment identifier. If applications want to create more robust fragment identifiers, they may do so by adding hash sums to fragment identifiers. These hash sums are used to detect a change in the resource, so that applications may warn users about the possibility that a fragment identifier might have been broken by a modification of the resource. Since fragment identifiers are interpreted by clients, hash sums are defined on MIME entities rather than the resource itself, and as such are specific to a certain representation of the resource, in case of text/plain resources the character encoding of MIME entity.
</p>
<p>Hash sums may specify the character encoding that has been used when creating the hash sums, and if such a specification is present, clients MUST check whether the character encoding specified for the hash sum and the character encoding of the retrieved MIME entity are equal, and clients MUST NOT check the hash sum if these values differ. However, clients MAY choose to transcode the retrieved MIME entity in the case of differing character encodings, and after doing so, they MAY check the hash sum (please note that this method is inhererently unreliable, though, because certain characters or character sequences may have been lost or normalized due to restrictions of the coded character set).
</p>
<a name="syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;Fragment Identification Syntax</h3>

<p>The syntax for the fragment identifiers is straightforward. The syntax defines four schemes, 'char', 'line', 'match', and hash (which can either be 'length' or 'md5'). The 'char' and 'line' can be used in two different variants, either the position variant (with a single number), or the range variant (with two comma-separated positions). The 'match' scheme has a regular expression as parameter, which must be specified as a string with escaped semicolons (because the semicolon is used to concatenate multiple fragment identification scheme parts). The hash scheme can either use the 'length' or the 'md5' scheme to specify a hash value.
</p>
<p>The following syntax definition uses ABNF as defined in RFC 4234 <a class="info" href="#RFC4234">[7]<span> (</span><span class="info">Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; October&nbsp;2005.</span><span>)</span></a>.
</p>
<p>
				</p>
<pre>
text-fragment =  text-scheme 0*( ";" text-scheme) 0*( ";" hash-scheme)
text-scheme   =  ( char-scheme / line-scheme / match-scheme )
hash-scheme   =  ( length-scheme / md5-scheme ) [ "," charenc ]
char-scheme   =  "char=" ( position / range )
line-scheme   =  "line=" ( position / range )
match-scheme  =  "match=" regex
position      =  number
range         =  (position "," [ position ]) / ("," position )
number        =  1*( DIGIT )
regex         =  StringWithEscapedSemicolon
length-scheme =  "length=" number
md5-scheme    =  "md5=" md5-value
md5-value     =  32( hexdigit )
hexdigit      =  (DIGIT / "a" / "A" / "b" / "B" / "c" / "C" / "d" / "D" / "e" / "E" / "f" / "F" )
charenc       =  StringWithEscapedSemicolon
</pre><p>

			
</p>
<p>The StringWithEscapedSemicolon is a string where all characters may appear literally (except the characters which are required by the URI syntax to be escaped), with the exception of a semicolon. A semicolon that should be part of the regular expression must be escaped with a leading backslash, and implementations MUST make sure to properly interpret regular expressions, properly dereferencing all escape mechanisms that apply (ie, URI encoding, semicolon escaping, and BRE escaping, as well as any additional escaping that may be present due to the context of the URI).
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;Non-ASCII Characters in Regular Expressions</h3>

<p>RFC 3986 <a class="info" href="#RFC3986">[5]<span> (</span><span class="info">Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> only allows a subset of ASCII as characters in URIs. Consequently, it is not possible to use non-ASCII characters in URIs. However, using Internationalized Resource Identifiers (IRI) as defined by RFC 3987 <a class="info" href="#RFC3987">[8]<span> (</span><span class="info">Duerst, M. and M. Suignard, &ldquo;Internationalized Resource Identifiers (IRI),&rdquo; January&nbsp;2005.</span><span>)</span></a>, it is possible to use non-ASCII characters, using the encoding defined by IRI. Thus, using IRIs it is possible to use non-ASCII characters in regular expressions, and implementations MUST make sure to correctly handle any non-ASCII characters in regular expressions, if they accept IRI-encoded text/plain fragment identifiers.
</p>
<a name="hashsums"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;Hash Sums</h3>

<p>A hash sum can either specify a MIME entity's length, or its MD5 fingerprint. In both cases, it can optionally specify the character encoding which had been used when calculating the hash sum, so that clients interpreting the fragment identifier may check whether they are using the same character encoding for their calculations. For lenghts, the character encoding is necessary because it may influence the character count (for example, a combining a-umlaut character which counts as two characters in Unicode will be collapsed to a single a-umlaut character in ISO 8859 encoding). Using Unicode terminology, this means that the length of a text/plain MIME entity is computed based on its "code points" (other possibilities would have included "code units", which depend on the encoding, and "graphemes", which require knowledge about code point semantics). For MD5 fingerprints, the character encoding is necessary because the MD5 algorithm works on the binary representation of the text/plain resource.
</p>
<p>The length of a text/plain MIME entity is calculated by using the principles defined in <a class="info" href="#char-and-line">Section&nbsp;2.1.1.2<span> (</span><span class="info">Characters and Lines</span><span>)</span></a>. The MD5 fingerprint of a text/plain MIME entity is calculated by using the algorithm presented in <a class="info" href="#RFC1321">[9]<span> (</span><span class="info">Rivest, R., &ldquo;The MD5 Message-Digest Algorithm,&rdquo; April&nbsp;1992.</span><span>)</span></a>, encoding the result in 16 hexadecimal digits (using uppercase or lowercase letters) as a representation of the 128 bit which are the result of the MD5 algorithm.
</p>
<a name="processing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;Fragment Identifier Processing</h3>

<a name="position-handling"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;Handling of position Values</h3>

<p>If any position value (as a position or inside a range) is greater than the value for the actual MIME entity, then it identifies the last character or line position of the MIME entity. If the first position value in a range is not present, then the range extends from the start of the MIME entity. If the second position value in a range is not present, then the range extends to the end of the MIME entity. If a range scheme's positions are not properly ordered (ie, the first number is less than the second), then this scheme part MUST be ignored.
</p>
<a name="hash-handling"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;Handling of Hash Sums</h3>

<p>Clients are not required to implement the handling of hash sums, so they MAY choose to ignore hash sum information altogether. However, if they do implement hash sum handling, they MUST implement it as follows:
</p>
<p>If a fragment identifier contains a hash sum, and a client retrieves a MIME entity and detects that the hash sum has changed (observing the character encoding specification as described in <a class="info" href="#hashsums">Section&nbsp;3.2<span> (</span><span class="info">Hash Sums</span><span>)</span></a>, if present), then the client SHOULD NOT interpret any other text/plain fragment identifier scheme part. A client MAY signal this situation to the user.
</p>
<a name="error-handling"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;Syntax Errors in Fragment Identifiers</h3>

<p>If a fragment identifier contains a syntax error (i.e., does not conform to the syntax specified in <a class="info" href="#syntax">Section&nbsp;3<span> (</span><span class="info">Fragment Identification Syntax</span><span>)</span></a>), then it MUST be ignored by clients. Clients SHOULD NOT make any attempt to correct or guess fragment identifiers. Syntax errors MAY be reported by clients.
</p>
<a name="examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;Examples</h3>

<p>The following examples show some usages for the fragment identifiers defined in this memo.
</p>
<p>
				</p>
<pre>
http://example.com/text.txt#char=100
</pre><p>

			
</p>
<p>This URI identifies the position after the 100th character of the text.txt MIME entity. It should be noted that it is not clear which octet(s) of the MIME entity this will be without retrieving the MIME entity and thus knowing which character encoding is it using (in case of HTTP, this information will be given in the response's Content-type header). If the MIME entity has fewer than 100 characters, the URI identifies the position after the MIME entity's last character.
</p>
<p>
				</p>
<pre>
http://example.com/text.txt#line=10,20
</pre><p>

			
</p>
<p>This URI identifies lines 11 to 20 of the text.txt MIME entity. If the MIME entity has fewer than 11 lines, it identifies the position after last line. If the MIME entity has less than 20 but at least 11 lines, it identifies the lines 11 to the last line of the MIME entity.
</p>
<p>
				</p>
<pre>
http://example.com/text.txt#match=searchterm
</pre><p>

			
</p>
<p>This URI identifies all occurrences of the regular expression 'searchterm' in the MIME entity, ie all occurrences of the string 'searchterm'. If there is more than one occurrence, then this URI identifies a disjoint fragment, consisting of all of these occurrences. If there is no occurrence of the search term, the URI does not identify a fragment.
</p>
<p>
				</p>
<pre>
http://example.com/text.txt#line=,1;match=searchterm
</pre><p>

			
</p>
<p>This URI identifies the first line and all occurrences of the regular expression 'searchterm' in the MIME entity. If there is an occurrence of 'searchterm' outside of the first line, then this URI identifies a disjoint fragment.
</p>
<p>
				</p>
<pre>
http://example.com/text.txt#match=hello\;
</pre><p>

			
</p>
<p>This URI identifies all occurrences of the regular expression 'hello;' in the MIME entity. The semicolon with the leading backslash has to be interpreted as a literal semicolon inside of the BRE, treating the '\;' as an escaped ';', so that the actual regular expression is 'hello;'.  If there is more than one occurrence of this regular expression, then this URI identifies a disjoint fragment, consisting of all of these occurrences.
</p>
<p>
				</p>
<pre>
http://example.com/text.txt#line=10,20;length=9876,UTF-8
</pre><p>

			
</p>
<p>As in the first example, this URI identifies lines 11 to 20 of the text.txt MIME entity. The additional length hash sum specifies that the MIME entity has a length of 9876 code points when encoded in UTF-8. If the client supports the length hash sum scheme, it may test the retrieved MIME entity for its length, but only if the retrieved MIME entity uses the UTF-8 encoding or has been locally trancoded into this encoding. If the length of the retrieved MIME entity does not match the specified length in the fragment identifier, the client SHOULD NOT interpret the line part and MAY signal this to the user.
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;Security Considerations</h3>

<p>Regular expression matching code is notoriously vulnerable to buffer overflow security holes, so any implementation supporting text/plain fragment identifiers SHOULD make sure that the code being used has been tested against buffer overflow attacks.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;Change Log</h3>

<p>This section will not be part of the final RFC text, it serves as a container for collecting the history of the individual draft versions.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;From -04 to -05</h3>

<p>
					</p>
<ul class="text">
<li>Added some explanatory text to the last paragraph of <a class="info" href="#robustness">Section&nbsp;2.2<span> (</span><span class="info">Fragment Identifier Robustness</span><span>)</span></a>.
</li>
<li>Added a paragraph about the importance of having fragment identification capabilities for out-of-line linking methods such as XLink to <a class="info" href="#why">Section&nbsp;1.3<span> (</span><span class="info">Why text/plain Fragment Identifiers?</span><span>)</span></a>.
</li>
<li>Added explanation of why the charset is important for length hash sums to <a class="info" href="#hashsums">Section&nbsp;3.2<span> (</span><span class="info">Hash Sums</span><span>)</span></a>.
</li>
<li>Added text that makes hash sum handling optional and allows clients to interpret fragment identifiers even if the hash sum did not match (changed MUST NOT to SHOULD NOT) to <a class="info" href="#hash-handling">Section&nbsp;4.2<span> (</span><span class="info">Handling of Hash Sums</span><span>)</span></a>.
</li>
<li>Added example using a length hash sum in <a class="info" href="#examples">Section&nbsp;5<span> (</span><span class="info">Examples</span><span>)</span></a>.
</li>
<li>RFC 2234 (ABNF) has been obsoleted by <a class="info" href="#RFC4234">[7]<span> (</span><span class="info">Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; October&nbsp;2005.</span><span>)</span></a>.
</li>
<li>Removed the "Open Issues" section for preparation of final draft before submission as RFC.
</li>
</ul><p>
				
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;From -03 to -04</h3>

<p>
					</p>
<ul class="text">
<li>URIs are now defined by RFC 3986 <a class="info" href="#RFC3986">[5]<span> (</span><span class="info">Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>, so the text and the references have been updated. In particular, RFC3986 defines a fragment identifier to be part of the URI, whereas in the obsoleted RFC 2396 URI specification, it was not part of a URI as such, but of a "URI reference".
</li>
<li>IRIs are now defined by RFC 3987 <a class="info" href="#RFC3987">[8]<span> (</span><span class="info">Duerst, M. and M. Suignard, &ldquo;Internationalized Resource Identifiers (IRI),&rdquo; January&nbsp;2005.</span><span>)</span></a>, so the text and the references have been updated.
</li>
<li>Changed IPR clause from RFC 3667 to RFC 3978 (updated version of RFC 3667).
</li>
</ul><p>
				
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;From -02 to -03</h3>

<p>
					</p>
<ul class="text">
<li>Replaced most occurrences of 'resource' with 'MIME entity', because the result of dereferencing a URI is not the resource itself, but some MIME entity (in our case of type text/plain) representing it. Thanks to Sandro Hawke for pointing this out.
</li>
<li>Moved "Open Issues" to the very back of the document.
</li>
<li>Added <a class="info" href="#processing">Section&nbsp;4<span> (</span><span class="info">Fragment Identifier Processing</span><span>)</span></a> to define the processing model for fragment identifiers (moved <a class="info" href="#position-handling">Section&nbsp;4.1<span> (</span><span class="info">Handling of position Values</span><span>)</span></a> from <a class="info" href="#syntax">Section&nbsp;3<span> (</span><span class="info">Fragment Identification Syntax</span><span>)</span></a> to <a class="info" href="#processing">Section&nbsp;4<span> (</span><span class="info">Fragment Identifier Processing</span><span>)</span></a>).
</li>
<li>Added hash scheme to make fragment identifiers more robust (<a class="info" href="#robustness">Section&nbsp;2.2<span> (</span><span class="info">Fragment Identifier Robustness</span><span>)</span></a>).
</li>
<li>Changed IPR clause from RFC 2026 to RFC 3667 (updated version of RFC 2026).
</li>
</ul><p>
				
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;From -01 to -02</h3>

<p>
					</p>
<ul class="text">
<li>Fundamental change in semantics: counts turn into positions (between characters or lines), so in order to identify a character or line, ranges must be used (which now use positions to specify the upper and lower bounds of the range).
</li>
<li>Made the first value of a range optional as well, so that line=,5 also is legal, identifying everything from the start of the MIME entity to the 5th line.
</li>
<li>Changed the syntax from paranthesis-style to a more traditional style using equals-signs.
</li>
</ul><p>
				
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;From -00 to -01</h3>

<p>
					</p>
<ul class="text">
<li>Made the second count value of ranges optional, so that something like line(10,) is legal and properly defined.
</li>
<li>Added non-normative reference to Internet draft about non-ASCII characters in search strings.
</li>
<li>Added <a class="info" href="#incremental">Section&nbsp;1.4<span> (</span><span class="info">Incremental Deployment</span><span>)</span></a> about incremental deployement.
</li>
<li>Added more elaborate examples.
</li>
<li>Added text about regex buffer overflow problems in <a class="info" href="#security">Section&nbsp;6<span> (</span><span class="info">Security Considerations</span><span>)</span></a>.
</li>
<li>Added <a class="info" href="#lineending">Section&nbsp;1.1.1<span> (</span><span class="info">Line Endings in text/plain MIME Entities</span><span>)</span></a> about line endings in text/plain resources.
</li>
<li>Added "Open Issues" to collect open issues regarding this memo (will be deleted in final RFC text).
</li>
</ul><p>
				
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[1]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; RFC&nbsp;2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2045">[2]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2045.txt">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>,&rdquo; RFC&nbsp;2045, November&nbsp;1996.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2046">[3]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2046.txt">Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</a>,&rdquo; RFC&nbsp;2046, November&nbsp;1996.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3676">[4]</a></td>
<td class="author-text"><a href="mailto:randy@qualcomm.com">Gellens, R.</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3676.txt">The Text/Plain Format and DelSp Parameters</a>,&rdquo; RFC&nbsp;3676, February&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3986">[5]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com">Fielding, R.</a>, and <a href="mailto:LMM@acm.org">L. Masinter</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3986.txt">Uniform Resource Identifier (URI): Generic Syntax</a>,&rdquo; RFC&nbsp;3986, January&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="ISO9945-2">[6]</a></td>
<td class="author-text">International Organization for Standardization, &ldquo;Information technology - Portable Operating System Interface (POSIX) - Part 2: Shell and Utilities,&rdquo; ISO&nbsp;9945-2, 1993.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4234">[7]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc4234.txt">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; RFC&nbsp;4234, October&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3987">[8]</a></td>
<td class="author-text">Duerst, M. and M. Suignard, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3987.txt">Internationalized Resource Identifiers (IRI)</a>,&rdquo; RFC&nbsp;3987, January&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1321">[9]</a></td>
<td class="author-text">Rivest, R., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc1321.txt">The MD5 Message-Digest Algorithm</a>,&rdquo; RFC&nbsp;1321, April&nbsp;1992.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Non-Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2854">[10]</a></td>
<td class="author-text">Connolly, D. and L. Masinter, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2854.txt">The 'text/html' Media Type</a>,&rdquo; RFC&nbsp;2854, June&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="XLink">[11]</a></td>
<td class="author-text">DeRose, S., Maler, E., and D. Orchard, &ldquo;XML Linking Language (XLink) Version 1.0,&rdquo; W3C Recommendation&nbsp;REC-xlink-20010627, June&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2781">[12]</a></td>
<td class="author-text"><a href="mailto:phoffman@imc.org">Hoffman, P.</a> and <a href="mailto:fyergeau@alis.com">F. Yergeau</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2781.txt">UTF-16, an encoding of ISO 10646</a>,&rdquo; RFC&nbsp;2781, February&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2629">[13]</a></td>
<td class="author-text"><a href="mailto:mrose@not.invisible.net">Rose, M.</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2629.txt">Writing I-Ds and RFCs using XML</a>,&rdquo; RFC&nbsp;2629, June&nbsp;1999.</td></tr>
</table>

<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;Where to send Comments</h3>

<p>Please send all comments and questions concerning this document to Erik Wilde.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;Acknowledgements</h3>

<p>This document has been prepared using the IETF document DTD described in RFC 2629 <a class="info" href="#RFC2629">[13]<span> (</span><span class="info">Rose, M., &ldquo;Writing I-Ds and RFCs using XML,&rdquo; June&nbsp;1999.</span><span>)</span></a>.
</p>
<p>Thanks for comments and suggestions provided by Marcel Baschnagel, John Cowan, Martin Duerst, Benja Fallenstein, Sandro Hawke, Dan Kohn, and Henrik Levkowetz.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Erik Wilde</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">ETH Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">ETH-Zentrum</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">8092 Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Switzerland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+41-44-6325132</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:net.dret@dret.net">net.dret@dret.net</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://dret.net/netdret/">http://dret.net/netdret/</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Intellectual Property Statement</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
<h3>Disclaimer of Validity</h3>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY),
THE INTERNET SOCIETY AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM
ALL WARRANTIES,
EXPRESS OR IMPLIED,
INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.</p>
<h3>Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The Internet Society (2006).
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<h3>Acknowledgment</h3>
<p class='copyright'>
Funding for the RFC Editor function is currently provided by the
Internet Society.</p>
</body></html>

