
<html><head><title>URI Fragment Identifiers for the text/plain Media Type</title>
<STYLE type='text/css'>
    .title { color: #990000; font-size: 22px; line-height: 22px; font-weight: bold; text-align: right;
             font-family: helvetica, arial, sans-serif }
    .filename { color: #666666; font-size: 18px; line-height: 28px; font-weight: bold; text-align: right;
                  font-family: helvetica, arial, sans-serif }
    p.copyright { color: #000000; font-size: 10px;
                  font-family: verdana, charcoal, helvetica, arial, sans-serif }
    p { margin-left: 2em; margin-right: 2em; }
    li { margin-left: 3em;  }
    ol { margin-left: 2em; margin-right: 2em; }
    ul.text { margin-left: 2em; margin-right: 2em; }
    pre { margin-left: 3em; color: #333333 }
    ul.toc { color: #000000; line-height: 16px;
             font-family: verdana, charcoal, helvetica, arial, sans-serif }
    H3 { color: #333333; font-size: 16px; line-height: 16px; font-family: helvetica, arial, sans-serif }
    H4 { color: #000000; font-size: 14px; font-family: helvetica, arial, sans-serif }
    TD.header { color: #ffffff; font-size: 10px; font-family: arial, helvetica, san-serif; valign: top }
    TD.author-text { color: #000000; font-size: 10px;
                     font-family: verdana, charcoal, helvetica, arial, sans-serif }
    TD.author { color: #000000; font-weight: bold; margin-left: 4em; font-size: 10px; font-family: verdana, charcoal, helvetica, arial, sans-serif }
     A:link { color: #990000; font-weight: bold;
              font-family: MS Sans Serif, verdana, charcoal, helvetica, arial, sans-serif }
     A:visited { color: #333333; font-weight: bold;
                 font-family: MS Sans Serif, verdana, charcoal, helvetica, arial, sans-serif }
     A:name { color: #333333; font-weight: bold;
              font-family: MS Sans Serif, verdana, charcoal, helvetica, arial, sans-serif }
    .link2 { color:#ffffff; font-weight: bold; text-decoration: none;
             font-family: monaco, charcoal, geneva, MS Sans Serif, helvetica, monotype, verdana, sans-serif;
             font-size: 9px }
    .RFC { color:#666666; font-weight: bold; text-decoration: none;
           font-family: monaco, charcoal, geneva, MS Sans Serif, helvetica, monotype, verdana, sans-serif;
           font-size: 9px }
    .hotText { color:#ffffff; font-weight: normal; text-decoration: none;
               font-family: charcoal, monaco, geneva, MS Sans Serif, helvetica, monotype, verdana, sans-serif;
               font-size: 9px }
</style>
</head>
<body bgcolor="#ffffff" text="#000000" alink="#000000" vlink="#666666" link="#990000">
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<table width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table width="100%" border="0" cellpadding="2" cellspacing="1">
<tr valign="top"><td width="33%" bgcolor="#666666" class="header">Network Working Group</td><td width="33%" bgcolor="#666666" class="header">E. Wilde</td></tr>
<tr valign="top"><td width="33%" bgcolor="#666666" class="header">Internet-Draft</td><td width="33%" bgcolor="#666666" class="header">Swiss Federal Institute of</td></tr>
<tr valign="top"><td width="33%" bgcolor="#666666" class="header">Expires: October 3, 2003</td><td width="33%" bgcolor="#666666" class="header">Technology</td></tr>
<tr valign="top"><td width="33%" bgcolor="#666666" class="header">&nbsp;</td><td width="33%" bgcolor="#666666" class="header">April 4, 2003</td></tr>
</table></td></tr></table>
<div align="right"><font face="monaco, MS Sans Serif" color="#990000" size="+3"><b><br><span class="title">URI Fragment Identifiers for the text/plain Media Type</span></b></font></div>
<div align="right"><font face="monaco, MS Sans Serif" color="#666666" size="+2"><b><span class="filename">draft-wilde-text-fragment-02</span></b></font></div>
<font face="verdana, helvetica, arial, sans-serif" size="2">

<h3>Status of this Memo</h3>
<p>
This document is an Internet-Draft and is in full conformance with all provisions of Section 10 of RFC2026.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as "work in progress."</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on October 3, 2003.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (C) The Internet Society (2003). All Rights Reserved.</p>

<h3>Abstract</h3>

<p>This memo defines URI fragment identifiers for text/plain resources. These fragment identifiers make it possible to refer to parts of a text resource, identified by character count or range, line count or range, or a regular expression. These identification methods can be combined to identify more than one sub-resource of a text/plain resource.
</p><a name="toc"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<h3>Table of Contents</h3>
<ul compact class="toc">
<b><a href="#issues">1.</a>&nbsp;
Open Issues<br></b>
<b><a href="#anchor1">2.</a>&nbsp;
Introduction<br></b>
<b><a href="#anchor2">2.1</a>&nbsp;
What is text/plain?<br></b>
<b><a href="#lineending">2.1.1</a>&nbsp;
Line Endings in text/plain Resources<br></b>
<b><a href="#anchor3">2.2</a>&nbsp;
What is a URI Fragment Identifier?<br></b>
<b><a href="#anchor4">2.3</a>&nbsp;
Why text/plain Fragment Identifiers?<br></b>
<b><a href="#incremental">2.4</a>&nbsp;
Incremental Deployment<br></b>
<b><a href="#anchor5">3.</a>&nbsp;
Fragment Identification Methods<br></b>
<b><a href="#anchor6">3.1</a>&nbsp;
Fragment Identification Schemes<br></b>
<b><a href="#princ">3.1.1</a>&nbsp;
Principles<br></b>
<b><a href="#comb-principle">3.1.2</a>&nbsp;
Combining the Principles<br></b>
<b><a href="#regex">3.1.3</a>&nbsp;
Regular Expressions<br></b>
<b><a href="#combining">3.1.4</a>&nbsp;
Combining Fragment Identification Scheme Parts<br></b>
<b><a href="#anchor7">4.</a>&nbsp;
Fragment Identification Syntax<br></b>
<b><a href="#anchor8">4.1</a>&nbsp;
Handling of position Values<br></b>
<b><a href="#anchor9">4.2</a>&nbsp;
Non-ASCII Characters in Regular Expressions<br></b>
<b><a href="#anchor10">5.</a>&nbsp;
Examples<br></b>
<b><a href="#security">6.</a>&nbsp;
Security Considerations<br></b>
<b><a href="#anchor11">7.</a>&nbsp;
Change Log<br></b>
<b><a href="#anchor12">7.1</a>&nbsp;
From -01 to -02<br></b>
<b><a href="#anchor13">7.2</a>&nbsp;
From -00 to -01<br></b>
<b><a href="#rfc.references1">&#167;</a>&nbsp;
Normative References<br></b>
<b><a href="#rfc.references2">&#167;</a>&nbsp;
Non-Normative References<br></b>
<b><a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br></b>
<b><a href="#BRE">A.</a>&nbsp;
POSIX BRE Syntax<br></b>
<b><a href="#anchor14">B.</a>&nbsp;
Where to send Comments<br></b>
<b><a href="#anchor15">C.</a>&nbsp;
Acknowledgements<br></b>
<b><a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br></b>
</ul>
<br clear="all">

<a name="issues"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;Open Issues</h3>

<p>This section will not be part of the final RFC text, it serves as a place to collect open issues regarding this memo.
</p>
<p>
<ul class="text">
<li>Provide more complex example(s).
</li>
<li>Provide short BRE syntax and description in <a href="#BRE">POSIX BRE Syntax</a> (by inclusion or by reference).
</li>
<li>Should regex ranges be allowed (ie, a fragment ranging from one regex match to another regex match)?
</li>
<li>Should a more sophisticated regex mechanism than BREs be used?
</li>
<li>Regexes by themselves may identify disjoint sub-resources. Should there be a mechanism to say something like "the 5th appearance of the following regex"? Or are users responsible for composing regexes which do not need this kind of additional mechanism?
</li>
<li>Is the concatenation of scheme parts (<a href="#combining">Combining Fragment Identification Scheme Parts</a>) and its semantics of joining the individual fragments a good thing? Or a bad thing?
</li>
<li>Should there be more schemes? Or less?
</li>
<li>Is it necessary to mention that applications must be able to transcode characters, because the text file and the fragment identifier may use different character encodings? What about character normalization? Should that be addressed or at least mentioned as being out of scope?
</li>
</ul><p>
</p>
<a name="anchor1"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;Introduction</h3>

<p>Compliant software MUST follow this specification. The capitalized key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 <a href="#RFC2119" title="Bradner, S., Key words for use in RFCs to Indicate Requirement Levels, March 1997.">[1]</a>.
</p>
<a name="rfc.section.2.1"></a><h4><a name="anchor2">2.1</a>&nbsp;What is text/plain?</h4>

<p>Internet Media Types as defined in RFC 2045 <a href="#RFC2045" title="Freed, N. and N. Borenstein, Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies, November 1996.">[2]</a> and RFC 2046 <a href="#RFC2046" title="Freed, N. and N. Borenstein, Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types, November 1996.">[3]</a> are used to identify different types and sub-types of media. RFC 2046 <a href="#RFC2046" title="Freed, N. and N. Borenstein, Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types, November 1996.">[3]</a> and RFC 2646 <a href="#RFC2646" title="Gellens, R., The Text/Plain Format Parameter, August 1999.">[4]</a> specify the text/plain media type, which is used for simple, unformatted text. Quoting from RFC 2046 <a href="#RFC2046" title="Freed, N. and N. Borenstein, Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types, November 1996.">[3]</a>: "Plain text does not provide for or allow  formatting commands, font attribute specifications, processing instructions, interpretation directives, or content markup. Plain text is seen simply as a linear sequence of characters, possibly
   interrupted by line breaks or page breaks."
</p>
<p>The text/plain media type does not restrict the character encoding, any character encoding may be used. In the absence of an explicit character encoding declaration, US-ASCII is assumed as the default character encoding. This variability of the character encoding makes it impossible to count characters in a text/plain resource without taking the character encoding into account, because there are many character encodings using more than one octet per character.
</p>
<p>The biggest advantage of text/plain resources is their portability among different platforms. As long as they use popular character encodings (such as US-ASCII), they can be displayed and processed on virtually every computer system.
</p>
<a name="rfc.section.2.1.1"></a><h4><a name="lineending">2.1.1</a>&nbsp;Line Endings in text/plain Resources</h4>

<p>RFC 2046 <a href="#RFC2046" title="Freed, N. and N. Borenstein, Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types, November 1996.">[3]</a> and RFC 2646 <a href="#RFC2646" title="Gellens, R., The Text/Plain Format Parameter, August 1999.">[4]</a> specify that line endings in text/plain resources are represented by CR+LF character sequences. In implementation practice, however, text/plain resources use different conventions, for example depending on the operating system they have been created with (in most cases, Unix uses LF, MacOS uses CR, and Windows uses CR+LF). Because of this diversity of conventions, implementations interpreting text/plain fragment identifiers MUST take different line ending conventions into account.
</p>
<p>Line endings in text/plain resources MAY be represented by other character (sequences) than CR+LF, specifically CR, LF, NEL, and CR+NEL. All these character (sequences) MUST be interpreted as line endings. This interpretation MUST affect the evaluation of text/plain fragment identifiers. All representations of line endings (CR+LF, CR, LF, NEL, and CR+NEL) MUST be treated as a single character in character counts. For the purpose of regular expression matching, all representations of line endings must be treated as single LF characters. The reason for this is that fragment identifiers should not be broken by converting a file from one line ending convention to another.
</p>
<p>In general, the line ending conventions used in text/plain resources depends on the character encoding of the resource. Implementations SHOULD attempt to be as accurate as possible in recognizing line ending specific to particular character encodings, and MUST treat all these line endings as one character in character counts, and single LF characters for regular expression matching.
</p>
<a name="rfc.section.2.2"></a><h4><a name="anchor3">2.2</a>&nbsp;What is a URI Fragment Identifier?</h4>

<p>URIs are the identification mechanism for resources on the Web. The URI syntax specified in RFC 2396 <a href="#RFC2396" title="Berners-Lee, T., Fielding, R. and L. Masinter, Uniform Resource Identifiers (URI): Generic Syntax, August 1998.">[5]</a> includes as part of a URI reference a fragment identifier, which (quoting from RFC 2396 <a href="#RFC2396" title="Berners-Lee, T., Fielding, R. and L. Masinter, Uniform Resource Identifiers (URI): Generic Syntax, August 1998.">[5]</a>) "consists of additional reference information to be interpreted by the user agent after the retrieval action has been successfully completed.  As such, it is not part of a URI, but is often used in conjunction with a URI. The semantics of a fragment identifier is a property of the data resulting from a retrieval action, regardless of the type of URI used in the reference.  Therefore, the format and interpretation of fragment identifiers is dependent on the media type of the retrieval result."
</p>
<p>The most popular fragment identifier is defined for text/html (defined in RFC 2854 <a href="#RFC2854" title="Connolly, D. and L. Masinter, The 'text/html' Media Type, June 2000.">[8]</a>), and makes it possible to refer to a specific element (identified by a 'name' or 'id' attribute) of an HTML document.
</p>
<a name="rfc.section.2.3"></a><h4><a name="anchor4">2.3</a>&nbsp;Why text/plain Fragment Identifiers?</h4>

<p>Referring to specific parts of a resource can be very useful, because it enables users to create more specific references. Rather than pointing to a whole resource, users can create references to the part they really are interested in or want to talk about. Even though it is suggested that fragment identification methods are specified in a media type's MIME registration, many media types do not have fragment identification methods associated with them.
</p>
<p>Fragment identifiers are only useful if supported by the client, because they are only interpreted by the client. Therefore, a new fragment identification method will require some time to be adopted by clients, and older clients will not support it. However, because the URI reference still works even if the fragment identifier is not supported (the resource is retrieved, but the fragment identifier is not interpreted), rapid adoption is not highly critical to ensure the success of a new fragment identification method.
</p>
<p>Fragment identifiers for text/plain make it possible to refer to specific parts of a text resource, using concepts of positions and ranges, which may be applied to characters and lines. The also support locating a fragment by using a regular expression for searching for a specific character sequence. Thus, text/plain fragment identifiers enable users to exchange information more specifically, thereby reducing time and effort that is necessary to manually search for the relevant part of a text/plain resource.
</p>
<a name="rfc.section.2.4"></a><h4><a name="incremental">2.4</a>&nbsp;Incremental Deployment</h4>

<p>As long as support for text/plain fragment identifiers is not implemented by all programs, it is important to consider the implications of incremental deployment. Clients (for example, Web browsers) not supporting the text/plain fragment identifier described in this memo will work with URI references to text/plain resources, but they will fail to locate the sub-resource identified by the fragment identifier. This is a reasonable fallback behavior, and in general users should take into account the possibility that a program interpreting a given URI reference will fail to interpret the fragment identifier part. Since fragment identifier evaluation is local to the client (and happens after retrieving the resource), there is no way for a server to determine whether a requesting client is using a URI reference containing a fragment identifier.
</p>
<a name="anchor5"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;Fragment Identification Methods</h3>

<p>The identification of resource fragments of text/plain resources can be based on different foundations. Since it is not possible to insert explicit, invisible identifiers into a text/plain 
resource (as for example used in HTML documents, implemented through special attributes), fragment identification has to rely on certain inherent criteria of the resource. This memo specifies fragment identification using five different methods, character positions and ranges, line positions and ranges, and regular expression matching.
</p>
<p> When interpreting character or line numbers, implementations MUST take the character encoding of the resource into account, because character count and octet count may differ for the character encoding being used. For example, a resource using UTF-16 encoding (as specified in RFC 2718 <a href="#RFC2781" title="Hoffman, P. and F. Yergeau, UTF-16, an encoding of ISO 10646, February 2000.">[9]</a>) uses two octets per character, and it may have a leading BOM (Byte-Order Mark), which does not count as a character and thus also affects the mapping from a simple octet count to a character count.
</p>
<a name="rfc.section.3.1"></a><h4><a name="anchor6">3.1</a>&nbsp;Fragment Identification Schemes</h4>

<p>Fragment identification can be done using regular expressions or combining two orthogonal principles, which are positions and ranges, and characters and lines. The following section describe the principles themselves, while <a href="#comb-principle">Combining the Principles</a> describes the combination of the principles.
</p>
<a name="rfc.section.3.1.1"></a><h4><a name="princ">3.1.1</a>&nbsp;Principles</h4>

<a name="rfc.section.3.1.1.1"></a><h4><a name="princ-posrang">3.1.1.1</a>&nbsp;Positions and Ranges</h4>

<p>A position does not identify an actual fragment of the resource, but a position inside the resource, which could be regarded as a fragment of zero length. The usa case for positions is to provide pointers for applications which may use them to implement functionalities such as "insert some text here", which needs a position rather than a fragment. Positions are counted from zero (position zero being before the first character or line of a text/plain resource), so that a text/plain resource having one character has two positions, one before the first character (position 0), and one after the first character (position 1).
</p>
<p>Since positions are fragments of length zero, applications SHOULD use other methods than highlighting to indicate positions, the most reasonable way being the positions of a cursor (if the application supports the concept of a cursor).
</p>
<p>Ranges, on the other hand, identify fragments of a resource that have a length that may be greater than zero. As a general principle for ranges, they specify both a lower and a upper bound. The start or the end of a range specification may be omitted, defaulting to the first repectively last position of the resource. The ending position of a range must have a value greater than or equal to the lower position (consequently, a range with identical lower and upper positions is legal, and identifies a range of length 0, which is equivalent to a position). Counting for ranges uses positions, so that a fragment containing one entity is specified by using a range with two adjacent positions.
</p>
<p>Since ranges are fragments with a length greater than zero, applications SHOULD use methods like highlighting to indicate ranges (if the application supports the concept of highlighting).
</p>
<p>For positions and ranges it is implicitly assumed that if a number is greater than the actual number of entities in the resource, then it is referring to the last entity of the resource.
</p>
<a name="rfc.section.3.1.1.2"></a><h4><a name="pric-charline">3.1.1.2</a>&nbsp;Characters and Lines</h4>

<p>The concept of positions and ranges may be applied to characters and lines. In both cases, positions indicate points between entities, while ranges identify zero or more entities by indicating positions.
</p>
<p>Character positions are numbered starting with zero (ignoring initial BOM marks or similar concepts that are not part of the actual textual content of a text/plain resource), and counting each character separately, with the exception of line endings, which are always counted as one character (<a href="#lineending">Line Endings in text/plain Resources</a> describes how line endings MUST be identified).
</p>
<p>Line positions are numbered starting with zero (with line position zero always being identical with character position zero), with <a href="#lineending">Line Endings in text/plain Resources</a> describing how line endings must be identified. Fragments identified by lines include the line endings, so applications identifying line-based fragments MUST include the line endings in the fragment identification they are using (eg, the highlighted selection). If a resource does not contain any line endings, then it consists of a single (the first) line.
</p>
<a name="rfc.section.3.1.2"></a><h4><a name="comb-principle">3.1.2</a>&nbsp;Combining the Principles</h4>

<p>In the following sections, the principles described in the preceding section are combined, resulting in four use cases.
</p>
<a name="rfc.section.3.1.2.1"></a><h4><a name="charposi">3.1.2.1</a>&nbsp;Character Position</h4>

<p>Using the char scheme followed by a single number, it is possible to point to a character position (ie, a fragment of length zero between two characters). Rather than identifying a fragment consisting of a number of characters, this method identifies a position between two characters (or before the first or after the last character). Character position counting starts with 0, so the character position before the first character of a text/plain resource has the character position 0, and a resource containing n distinct characters has n+1 distinct character positions.
</p>
<a name="rfc.section.3.1.2.2"></a><h4><a name="charrange">3.1.2.2</a>&nbsp;Character Range</h4>

<p>If it is necessary to identify a fragment of zero or more characters using character counting, this can be done by using a character range, using the char scheme followed by a range specification. A character range is a consecutive region of the resource that extends from the starting character position of the range to the ending character position of the range.
</p>
<a name="rfc.section.3.1.2.3"></a><h4><a name="lineposi">3.1.2.3</a>&nbsp;Line Position</h4>

<p>Using the line scheme followed by a single number, it is possible to point to a character position (ie, a fragment of length zero between two lines). Rather than identifying a fragment consisting of a number of lines, this method identifies a position between two lines (or before the first or after the last line). Line position counting starts with 0, so the line position before the first line of a text/plain resource has the line position 0, and a resource containing n distinct lines has n+1 distinct line positions.
</p>
<a name="rfc.section.3.1.2.4"></a><h4><a name="linerange">3.1.2.4</a>&nbsp;Line Range</h4>

<p>If it is necessary to identify a fragment of zero or more lines using line counting, this can be done by using a line range, using the line scheme followed by a range specification. A line range is a consecutive region of the resource that extends from the starting line position of the range to the ending line position of the range. 
</p>
<a name="rfc.section.3.1.3"></a><h4><a name="regex">3.1.3</a>&nbsp;Regular Expressions</h4>

<p>A common problem with fragment identifiers is their robustness (to changes in the resource), and character and line counts can be broken very easily. A more robust way of identifying a fragment is by searching for a specific pattern. Thus, it is possible to use a Basic Regular Expression (BRE) as defined by ISO 9945-2 <a href="#ISO9945-2" title="International Organization for Standardization, Information technology - Portable Operating System Interface (POSIX) - Part 2: Shell and Utilities, 1993.">[6]</a> (the POSIX standard) as a fragment identifier (<a href="#BRE">POSIX BRE Syntax</a> contains a short summary of the POSIX BRE syntax).
</p>
<a name="rfc.section.3.1.4"></a><h4><a name="combining">3.1.4</a>&nbsp;Combining Fragment Identification Scheme Parts</h4>

<p>While in most cases only one fragment identification scheme part will be used, it is possible to combine them. By simply concatenating different fragment identification scheme parts, separated by a semicolon, the whole fragment identifier refers to the union of all fragments of the text resource identified by the individual fragment identification scheme parts. This way, it is possible to identify disjoint ranges, such as multiple line ranges.
</p>
<p>It should be noticed that regular expressions by themselves may identify disjoint fragments, which is true in any case where the regular expression matches more than one occurrence in the resource.
</p>
<p>Since disjoint fragments can be identified, implementations SHOULD make sure that these fragments are appropriately marked, for example by highlighting the fragment (rather than only scrolling to some line, which only identifies a single location in the resource). If an implementation can not mark disjoint fragments, it MAY resort to marking only the first of the disjoint fragments. However, the exact method of how implementations deal with disjoint fragments depends on the application and interface, and is beyond the scope of this memo.
</p>
<a name="anchor7"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;Fragment Identification Syntax</h3>

<p>The syntax for the fragment identifiers is straightforward. The syntax defines three schemes, 'char', 'line', and 'match'. The 'char' and 'line' can be used in two different variants, either the position variant (with a single number), or the range variant (with two comma-separated positions). The 'match' scheme has a regular expression as parameter, which must be specified as a string with escaped semicolons (because the semicolon is used to concatenate multiple fragment identification schem parts).
</p>
<p>The following syntax definition uses ABNF as defined in RFC 2234 <a href="#RFC2234" title="Crocker, D. and P. Overell, Augmented BNF for Syntax Specifications: ABNF, November 1997.">[7]</a>.
</p>
<p></p>
</font><pre>
text-fragment =  text-scheme 0*( ";" text-scheme)
text-scheme   =  ( char-scheme / line-scheme / match-scheme )
char-scheme   =  "char=" ( position / range )
line-scheme   =  "line=" ( position / range )
match-scheme  =  "match=" regex
position      =  number
range         =  (position "," [ position ]) / ("," position )
number        =  1*DIGIT
regex         =  StringWithEscapedSemicolon
					</pre><font face="verdana, helvetica, arial, sans-serif" size="2">
<p>

</p>
<p>The StringWithEscapedSemicolon is a string where all characters may appear literally (except the characters which are required by the URI syntax to be escaped), with the exception of a semicolon. A semicolon that should be part of the regular expression must be escaped with a leading backslash, and implementations MUST make sure to properly interpret regular expressions, properly dereferencing all escape mechanisms that apply (ie, URI encoding, semicolon escaping, and BRE escaping, as well as any additional escaping that may be present due to the context of the URI reference).
</p>
<a name="rfc.section.4.1"></a><h4><a name="anchor8">4.1</a>&nbsp;Handling of position Values</h4>

<p>If any position value (as a position or inside a range) is greater than the value for the actual resource, then it identifies the last character or line position of the resource. If the first position value in a range is not present, then the range extends from the start of the resource. If the second position value in a range is not present, then the range extends to the end of the resource. If a range scheme's positions are not properly ordered (ie, the first number is less than the second), then this scheme part MUST be ignored.
</p>
<a name="rfc.section.4.2"></a><h4><a name="anchor9">4.2</a>&nbsp;Non-ASCII Characters in Regular Expressions</h4>

<p>RFC 2396 <a href="#RFC2396" title="Berners-Lee, T., Fielding, R. and L. Masinter, Uniform Resource Identifiers (URI): Generic Syntax, August 1998.">[5]</a> does not define how to use non-ASCII characters in URIs. Consequently, it is not possible to use non-ASCII characters in URIs in a standardized and reliable way. However, work on Internationalized Resource Identifiers (IRI) <a href="#IRI" title="Duerst, M. and M. Suignard, Internationalized Resource Identifiers (IRI), March 2003.">[10]</a> is in progress, and as soon as this work results in a published RFC, it will be possible to use non-ASCII characters in regular expressions, using the encoding defined by IRI.
</p>
<a name="anchor10"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;Examples</h3>

<p>The following examples show some usages for the fragment identifiers defined in this memo.
</p>
<p></p>
</font><pre>
http://example.com/text.txt#char=100
					</pre><font face="verdana, helvetica, arial, sans-serif" size="2">
<p>

</p>
<p>This URI reference identifies the position after the 100th character of the text.txt resource. It should be noted that it is not clear which octet(s) of the resource this will be without retrieving the resource and thus knowing which character encoding is it using (in case of HTTP, this information will be given in the response's Content-type header). If the resource has fewer than 100 characters, the URI reference identifies the position after the resource's last character.
</p>
<p></p>
</font><pre>
http://example.com/text.txt#line=10,20
					</pre><font face="verdana, helvetica, arial, sans-serif" size="2">
<p>

</p>
<p>This URI reference identifies lines 11 to 20 of the text.txt resource. If the resource has fewer than 11 lines, it identifies the position after last line. If the resource has less than 20 but at least 11 lines, it identifies the lines 11 to the last line of the resource.
</p>
<p></p>
</font><pre>
http://example.com/text.txt#match=searchterm
					</pre><font face="verdana, helvetica, arial, sans-serif" size="2">
<p>

</p>
<p>This URI reference identifies all occurrences of the regular expression 'searchterm' in the resource, ie all occurrences of the string 'searchterm'. If there is more than one occurrence, then this URI reference identifies a disjoint fragment, consisting of all of these occurrences. If there is no occurrence of the search term, the URI reference does not identify a fragment.
</p>
<p></p>
</font><pre>
http://example.com/text.txt#line=,1;match=searchterm
					</pre><font face="verdana, helvetica, arial, sans-serif" size="2">
<p>

</p>
<p>This URI reference identifies the first line and all occurrences of the regular expression 'searchterm' in the resource. If there is an occurrence of 'searchterm' outside of the first line, then this URI reference identifies a disjoint fragment.
</p>
<p></p>
</font><pre>
http://example.com/text.txt#match=hello\;
					</pre><font face="verdana, helvetica, arial, sans-serif" size="2">
<p>

</p>
<p>This URI reference identifies all occurrences of the regular expression 'hello;' in the resource. The semicolon with the leading backslash has to be interpreted as a literal semicolon insode of the BRE, treating the '\;' as an escaped ';', so that the actual regular expression is 'hello;'.  If there is more than one occurrence of this regular expression, then this URI reference identifies a disjoint fragment, consisting of all of these occurrences.
</p>
<p></p>
</font><pre>
...
					</pre><font face="verdana, helvetica, arial, sans-serif" size="2">
<p>

</p>
<p>(more complex example...)
</p>
<a name="security"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;Security Considerations</h3>

<p>Regular expression matching code is notoriously vulnerable to buffer overflow security holes, so any implementation supporting text/plain fragment identifiers MUST make sure that the code being used has been tested against buffer overflow attacks.
</p>
<a name="anchor11"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;Change Log</h3>

<a name="rfc.section.7.1"></a><h4><a name="anchor12">7.1</a>&nbsp;From -01 to -02</h4>

<p>
<ul class="text">
<li>Fundamental change in semantics: counts turn into positions (between characters or lines), so in order to identify a character or line, ranges must be used (which now use positions to specify the upper and lower bounds of the range).
</li>
<li>Made the first value of a range optional as well, so that line=,5 also is legal, identifying everything from the start of the resource to the 5th line.
</li>
<li>Changed the syntax from paranthesis-style to a more traditional style using equals-signs.
</li>
</ul><p>
</p>
<a name="rfc.section.7.2"></a><h4><a name="anchor13">7.2</a>&nbsp;From -00 to -01</h4>

<p>
<ul class="text">
<li>Made the second count value of ranges optional, so that something like line(10,) is legal and properly defined.
</li>
<li>Added non-normative reference to Internet draft about non-ASCII characters in search strings.
</li>
<li>Added <a href="#incremental">Incremental Deployment</a> about incremental deployement.
</li>
<li>Added more elaborate examples.
</li>
<li>Added text about regex buffer overflow problems in <a href="#security">Security Considerations</a>.
</li>
<li>Added <a href="#lineending">Line Endings in text/plain Resources</a> about line endings in text/plain resources.
</li>
<li>Added <a href="#issues">Open Issues</a> to collect open issues regarding this memo (will be deleted in final RFC text).
</li>
</ul><p>
</p>
<a name="rfc.references1"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<h3>Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><b><a name="RFC2119">[1]</a></b></td>
<td class="author-text">Bradner, S., "<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">Key words for use in RFCs to Indicate Requirement Levels</a>", RFC 2119, March 1997.</td></tr>
<tr><td class="author-text" valign="top"><b><a name="RFC2045">[2]</a></b></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2045.txt">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>", RFC 2045, November 1996.</td></tr>
<tr><td class="author-text" valign="top"><b><a name="RFC2046">[3]</a></b></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2046.txt">Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</a>", RFC 2046, November 1996.</td></tr>
<tr><td class="author-text" valign="top"><b><a name="RFC2646">[4]</a></b></td>
<td class="author-text"><a href="mailto:randy@qualcomm.com">Gellens, R.</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2646.txt">The Text/Plain Format Parameter</a>", RFC 2646, August 1999.</td></tr>
<tr><td class="author-text" valign="top"><b><a name="RFC2396">[5]</a></b></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@ics.uci.edu">Fielding, R.</a> and <a href="mailto:masinter@parc.xerox.com">L. Masinter</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2396.txt">Uniform Resource Identifiers (URI): Generic Syntax</a>", RFC 2396, August 1998.</td></tr>
<tr><td class="author-text" valign="top"><b><a name="ISO9945-2">[6]</a></b></td>
<td class="author-text">International Organization for Standardization, "Information technology - Portable Operating System Interface (POSIX) - Part 2: Shell and Utilities", ISO 9945-2, 1993.</td></tr>
<tr><td class="author-text" valign="top"><b><a name="RFC2234">[7]</a></b></td>
<td class="author-text"><a href="mailto:dcrocker@imc.org">Crocker, D.</a> and <a href="mailto:paulo@turnpike.com">P. Overell</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2234.txt">Augmented BNF for Syntax Specifications: ABNF</a>", RFC 2234, November 1997.</td></tr>
</table>

<a name="rfc.references2"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<h3>Non-Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><b><a name="RFC2854">[8]</a></b></td>
<td class="author-text">Connolly, D. and L. Masinter, "<a href="ftp://ftp.isi.edu/in-notes/rfc2854.txt">The 'text/html' Media Type</a>", RFC 2854, June 2000.</td></tr>
<tr><td class="author-text" valign="top"><b><a name="RFC2781">[9]</a></b></td>
<td class="author-text"><a href="mailto:phoffman@imc.org">Hoffman, P.</a> and <a href="mailto:fyergeau@alis.com">F. Yergeau</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2781.txt">UTF-16, an encoding of ISO 10646</a>", RFC 2781, February 2000.</td></tr>
<tr><td class="author-text" valign="top"><b><a name="IRI">[10]</a></b></td>
<td class="author-text">Duerst, M. and M. Suignard, "<a href="http://www.ietf.org/internet-drafts/draft-duerst-iri-03.txt">Internationalized Resource Identifiers (IRI)</a>", draft-duerst-iri-03 (work in progress), March 2003.</td></tr>
<tr><td class="author-text" valign="top"><b><a name="RFC2629">[11]</a></b></td>
<td class="author-text"><a href="mailto:mrose@not.invisible.net">Rose, M.</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2629.txt">Writing I-Ds and RFCs using XML</a>", RFC 2629, June 1999.</td></tr>
</table>

<a name="rfc.authors"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Erik Wilde</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Swiss Federal Institute of Technology</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">ETH-Zentrum</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">8092 Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Switzerland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+41-1-6325132</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:net.dret@dret.net">net.dret@dret.net</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://dret.net/netdret/">http://dret.net/netdret/</a></td></tr>
</table>

<a name="BRE"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;POSIX BRE Syntax</h3>

<p>This section contains a short (and non-normative) summary of the POSIX BRE syntax defined in ISO 9945-2 <a href="#ISO9945-2" title="International Organization for Standardization, Information technology - Portable Operating System Interface (POSIX) - Part 2: Shell and Utilities, 1993.">[6]</a>. The definition of BRE syntax in ISO 9945-2 <a href="#ISO9945-2" title="International Organization for Standardization, Information technology - Portable Operating System Interface (POSIX) - Part 2: Shell and Utilities, 1993.">[6]</a> is the normative reference, and the following summary is for informative purposes only.
</p>
<p>(tbd - is there some rfc that could be referenced instead?)
</p>
<a name="anchor14"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;Where to send Comments</h3>

<p>Please send all comments and questions concerning this document to Erik Wilde.
</p>
<a name="anchor15"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;Acknowledgements</h3>

<p>This document has been prepared using the IETF document DTD described in RFC 2629 <a href="#RFC2629" title="Rose, M., Writing I-Ds and RFCs using XML, June 1999.">[11]</a>.
</p>
<p>Thanks for comments and suggestions provided by Dan Kohn, John Cowan, Benja Fallenstein, and Henrik Levkowetz.
</p><a name="rfc.copyright"><br><hr size="1" shade="0"></a>
<table border="0" cellpadding="0" cellspacing="2" width="30" height="15" align="right"><tr><td bgcolor="#990000" align="center" width="30" height="15"><a href="#toc" CLASS="link2"><font face="monaco, MS Sans Serif" color="#ffffff" size="1"><b>&nbsp;TOC&nbsp;</b></font></a><br></td></tr></table>
<h3>Intellectual Property Statement</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of
any intellectual property or other rights that might be claimed
to  pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; neither does
it represent that it has made any effort to identify any such
rights. Information on the IETF's procedures with respect to
rights in standards-track and standards-related documentation
can be found in BCP-11. Copies of claims of rights made
available for publication and any assurances of licenses to
be made available, or the result of an attempt made
to obtain a general license or permission for the use of such
proprietary rights by implementors or users of this
specification can be obtained from the IETF Secretariat.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its
attention any copyrights, patents or patent applications, or
other proprietary rights which may cover technology that may be
required to practice this standard. Please address the
information to the IETF Executive Director.</p>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright (C) The Internet Society (2003). All Rights Reserved.</p>
<p class='copyright'>
This document and translations of it may be copied and furnished to
others, and derivative works that comment on or otherwise explain it
or assist in its implementation may be prepared, copied, published and
distributed, in whole or in part, without restriction of any kind,
provided that the above copyright notice and this paragraph are
included on all such copies and derivative works. However, this
document itself may not be modified in any way, such as by removing
the copyright notice or references to the Internet Society or other
Internet organizations, except as needed for the purpose of
developing Internet standards in which case the procedures for
copyrights defined in the Internet Standards process must be
followed, or as required to translate it into languages other than
English.</p>
<p class='copyright'>
The limited permissions granted above are perpetual and will not be
revoked by the Internet Society or its successors or assignees.</p>
<p class='copyright'>
This document and the information contained herein is provided on an
&quot;AS IS&quot; basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.</p>
<h3>Acknowledgement</h3>
<p class='copyright'>
Funding for the RFC Editor function is currently provided by the
Internet Society.</p>
</font></body></html>

